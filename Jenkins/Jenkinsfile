node('master') {
    stage('Build and push') {
    docker.withRegistry('https://index.docker.io/v1/', 'docker-login'){    
    checkout scm

    def customImage = docker.build("jacksonlima91/forum-app:${env.BUILD_ID}")
    customImage.push()
    }
    }
    stage('Deploy'){
                sh "sed -i 's/forum-app.*/forum-app:$BUILD_NUMBER/g' docker-compose.yml"
                step([$class: 'DockerComposeBuilder', dockerComposeFile: 'docker-compose.yml', option: [$class: 'StartAllServices'], useCustomDockerComposeFile: true])
        }
}
